## 压测：

配置：10000线程 循环3次



测试接口：goods/toList

windows测试结果：1188QPS

![image-20220507143009237](D:\study\img\image-20220507143009237.png)

Linux测试结果：130QPS

![image-20220507145027356](C:\Users\11264\AppData\Roaming\Typora\typora-user-images\image-20220507145027356.png)



配置5000线程 循环三次 5000用户

测试接口：seckill/doSeckill

windows测试结果：968QPS 

![image-20220510161951108](D:\study\img\image-20220510161951108.png)

订单数量：301

秒杀订单数：301

库存出现：-15



**问题：**出现超卖，实际下单数远远大于10，出现库存为负数



## 优化：



### 页面缓存：（theamleaf所导致）

将html页面缓存到redis中去。

前后端分离的情况下该怎么做？

优化后Windows测试结果：1911QPS

优化后秒杀测试结果：1500qps

2500qps

### 对象缓存



## 超卖问题：



### 防止同一用户多次抢购问题：

**视频方案：**建立用户id和商品id的唯一联合索引，解决同一个用户秒杀多次的情况。

将订单放在redis里，key为用户id+goodsid，判断redis里是否有订单，没有再去下订单

#### 超卖问题：

利用数据库更新的行锁



## 接口优化：

### 预减库存：

首先将库存数在启动时放在redis中去，然后再redis中预减库存

### 下单：



